<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="admin.css">
    <style>
        .admin-panel { background-color: #2c2c2c; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        input { padding: 10px; border-radius: 5px; border: 1px solid #555; background: #333; color: #fff; width: 100%; box-sizing: border-box; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #444; padding-bottom: 10px; }
        .tab-btn { background: none; border: none; color: #888; font-size: 1.2em; cursor: pointer; padding: 10px; transition: 0.3s; }
        .tab-btn.active { color: #2ecc71; border-bottom: 3px solid #2ecc71; font-weight: bold; }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }

        .search-bar { display: flex; gap: 10px; margin-bottom: 15px; }
        .log-item { background: #222; padding: 10px; margin-bottom: 5px; border-left: 4px solid #3498db; }
        .risk-item { background: #222; padding: 10px; margin-bottom: 5px; border-left: 4px solid #e74c3c; display: flex; justify-content: space-between; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; color: #fff; }
        th, td { border: 1px solid #444; padding: 10px; text-align: left; word-break: break-word; }
        th { background-color: #2ecc71; color: #000; }
        
        .btn-sm { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; color: white; margin-right: 5px; margin-bottom: 5px; display: inline-block; }
        .btn-delete { background: #e74c3c; }
        .btn-promote { background: #3498db; }
        .btn-demote { background: #f39c12; }
        .btn-reset { background: #e67e22; }
        
        .btn-backup { background-color: #8e44ad; margin-right: 10px; }
        .btn-restore { background-color: #d35400; margin-right: 10px; }
        
        /* MODAL STYLES */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background-color: #2c2c2c; margin: 5% auto; padding: 20px; border: 1px solid #444; width: 80%; max-width: 900px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); color: #f0f0f0; max-height: 90vh; overflow-y: auto; }
        .close-modal { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-modal:hover { color: #fff; }
        
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .detail-card { background: #1a1a1a; padding: 15px; border-radius: 8px; border-left: 4px solid #2ecc71; }
        .detail-card h4 { margin-top: 0; color: #2ecc71; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        .user-link { color: #3498db; cursor: pointer; font-weight: bold; text-decoration: underline; }
        .user-link:hover { color: #5dade2; }

        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
    </style>
</head>
<body>
    <header class="main-header">
        <h1>ADMIN CONTROL CENTER</h1>
        <div class="options">
            <button onclick="downloadBackup()" class="action-btn btn-backup">üì¶ Backup</button>
            <input type="file" id="restoreInput" style="display: none;" accept=".json" onchange="uploadRestore()">
            <button onclick="document.getElementById('restoreInput').click()" class="action-btn btn-restore">‚ôªÔ∏è Restore DB</button>
            <button id="logoutBtn" class="action-btn logout-btn">Logout</button>
        </div>
    </header>

    <main class="main-content">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('users')">User Management</button>
            <button class="tab-btn" onclick="switchTab('risk')">‚ö†Ô∏è At-Risk Students</button>
            <button class="tab-btn" onclick="switchTab('logs')">üìú Security Logs</button>
        </div>

        <div id="tab-users" class="tab-content active">
            <div class="admin-panel">
                <h3 style="color: #2ecc71; margin-top:0;">Create New User</h3>
                <form id="createUserForm">
                    <div class="form-grid">
                        <input type="text" id="new_first" placeholder="First Name" required>
                        <input type="text" id="new_last" placeholder="Last Name" required>
                        <input type="text" id="new_mobile" placeholder="Mobile (10 Digits)" maxlength="10" required>
                        <input type="password" id="new_pass" placeholder="Password (Min 6 chars)" minlength="6" required>
                        <input type="text" id="new_college" placeholder="College Name" required>
                        <input type="text" id="new_sem" placeholder="Semester" required>
                        <input type="number" id="new_year" placeholder="Year" required>
                        <input type="text" id="new_courses" placeholder="Courses (Comma separated)" required>
                    </div>
                    <button type="submit" class="action-btn" style="width:100%; margin-top:15px;">Create User</button>
                </form>
            </div>

            <div class="search-bar">
                <input type="text" id="searchName" placeholder="Search by Name..." onkeyup="filterUsers()">
                <input type="text" id="searchCollege" placeholder="Filter by College..." onkeyup="filterUsers()">
                <input type="text" id="searchMobile" placeholder="Filter by Mobile..." onkeyup="filterUsers()">
            </div>

            <div id="userTableContainer">Loading...</div>
        </div>

        <div id="tab-risk" class="tab-content">
            <h3>Students below 75% Attendance</h3>
            <button class="action-btn" onclick="loadAtRiskData()" style="margin-bottom:15px;">Refresh Data</button>
            <div id="riskContainer">Click Refresh...</div>
        </div>

        <div id="tab-logs" class="tab-content">
            <h3>System Audit Logs</h3>
            <div id="logsContainer">Loading logs...</div>
        </div>
    </main>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="color: #2ecc71; margin-top: 0;">User Details</h2>
            <div id="modalBody">
                <p>Loading...</p>
            </div>
        </div>
    </div>

    <script src="admin_dashboard.js"></script>
</body>
</html>